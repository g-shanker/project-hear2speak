<section id="appointment" class="appointment-section">
  <div class="container">
    
    <!-- External Section Title -->
    @if (!submitSuccess()) {
      <div class="text-center mb-8">
        <h2 class="section-title">Request an Appointment</h2>
        <p class="section-subtitle">
            Ready to start your journey? Fill out the form below.
        </p>
      </div>
    }

    <!-- The Card Wrapper -->
    <div class="form-card">
      
      <!-- SUCCESS STATE -->
      @if (submitSuccess()) {
        <div class="success-message">
          <div class="icon-circle">
            <span class="material-icons">check</span>
          </div>
          <h3>Request Sent!</h3>
          <p>We have received your details. We will contact you shortly to confirm your time.</p>
          <button class="btn-outline" (click)="resetView()">Book Another</button>
        </div>
      } 
      
      <!-- FORM STATE -->
      @else {
        
        <!-- 1. FORM HEADER -->
        <div class="form-header">
           
           <!-- ERROR BANNER -->
           @if (submitError()) {
            <div class="error-banner">
              <div class="banner-icon">
                <span class="material-icons">error_outline</span>
              </div>
              <div class="error-content">
                <h4>Something went wrong</h4>
                <p>We couldn't submit your request. Please check your connection and try again.</p>
                
                <!-- New Action Area -->
                <div class="error-actions">
                  <span class="help-text">Issue persisting?</span>
                  <a href="#contact" class="btn-error-small">Contact Us Directly</a>
                </div>
              </div>
            </div>
          }
          
          <!-- @else {
             <p class="form-instruction">Please provide your details below.</p>
          } -->
        </div>

        <!-- 2. SCROLLABLE BODY -->
        <div class="form-scroll-body">
           <app-appointment-form
                [mode]="mode"
                [defaultDurationInMinutes]="defaultDurationInMinutes"
                [defaultAppointmentStatus]="defaultAppointmentStatus"
            ></app-appointment-form>
        </div>

        <!-- 3. FORM FOOTER -->
        <div class="form-footer">
          <button 
            class="btn-cta full-width-btn" 
            (click)="onSubmit()"
            [disabled]="isSubmitting()">
            
            @if (isSubmitting()) {
              Processing...
            } @else {
              @if (submitError()) {
                Retry Request
              } @else {
                Submit Request
              }
            }
          </button>
        </div>
      }

    </div>
  </div>
</section>
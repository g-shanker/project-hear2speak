/* No @use needed */

:host {
  display: block;
  height: 100%;
  overflow: hidden; /* Page container shouldn't scroll */
}

.calendar-layout {
  height: 100%;
  display: flex;
  flex-direction: column;
  background-color: var(--bg-app);
}

/* 1. Top Search Bar Wrapper */
.calendar-header {
  flex-shrink: 0;
  padding: 1rem 1.5rem 0 1.5rem; /* Add breathing room */
  background-color: var(--bg-app);
}

/* 2. Main Workspace (Calendar + Side Panel) */
.calendar-main {
  flex: 1;
  min-height: 0; /* Flex overflow fix */
  display: flex;
  flex-direction: row;
  overflow: hidden;
  padding: 1rem 1.5rem 1.5rem 1.5rem; /* Consistent padding */
  gap: 1.5rem;
}

/* 3. The Calendar Container */
.calendar-wrapper {
  flex: 1;
  min-width: 0; /* Allows shrinking when Side Panel opens */
  height: 100%;
  
  /* The "Canvas" Look */
  background: var(--bg-surface);
  border: 0.0625rem solid var(--border-subtle);
  border-radius: var(--radius-md);
  
  /* Internal Scrolling handled by FullCalendar, but we clip it here */
  overflow: hidden; 
  display: flex;
  flex-direction: column;

  /* =========================================================
     FULLCALENDAR OVERRIDES (The "Refined" Theme)
     ========================================================= */
  ::ng-deep {
    
    /* A. Toolbar (Header) */
    .fc-header-toolbar {
      padding: 1rem !important;
      margin-bottom: 0 !important;
      border-bottom: 0.0625rem solid var(--border-subtle);
    }

    .fc-toolbar-title {
      font-size: 1.125rem !important; /* 18px */
      font-weight: 600;
      color: var(--text-main);
      font-family: var(--font-sans);
    }

    /* B. Buttons (Today, Month, Week) */
    .fc-button {
      background-color: var(--bg-surface);
      border: 0.0625rem solid var(--border-strong);
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      text-transform: capitalize;
      border-radius: var(--radius-sm);
      padding: 0.4rem 0.8rem;
      box-shadow: none !important;
      transition: all 0.15s ease;

      &:hover {
        background-color: var(--bg-hover);
        border-color: var(--text-muted);
        color: var(--text-main);
      }

      &:focus {
        box-shadow: 0 0 0 2px var(--primary-100) !important;
      }

      /* Active State (Selected View) */
      &.fc-button-active {
        background-color: var(--primary-50);
        border-color: var(--primary-500);
        color: var(--primary-700);
        z-index: 2; /* Bring to front */
      }
    }
    
    .fc-button-primary:not(:disabled).fc-button-active, 
    .fc-button-primary:not(:disabled):active {
      background-color: var(--primary-50);
      border-color: var(--primary-500);
      color: var(--primary-700);
    }

    /* C. The Grid & Scroll Area */
    .fc-view-harness {
      background-color: var(--bg-surface);
    }
    
    .fc-theme-standard td, 
    .fc-theme-standard th,
    .fc-theme-standard .fc-scrollgrid {
      border-color: var(--border-subtle);
    }

    .fc-col-header-cell-cushion {
      color: var(--text-muted);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.5rem 0;
    }

    .fc-timegrid-slot-label-cushion {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    /* ---------------------------------------------------------
       D. EVENT STYLING (The "Sticker" Look)
       This matches the CSS classes mapped in calendar-utils.ts
       --------------------------------------------------------- */
    .fc-event {
      /* Base Card Shape */
      border: 1px solid transparent; /* Placeholder for border */
      border-radius: var(--radius-sm);
      box-shadow: 0 1px 3px rgba(0,0,0,0.08); /* Crisp shadow */
      
      padding: 0.125rem 0.35rem;
      margin: 0 0.125rem 0.125rem 0.125rem; 
      cursor: pointer;
      transition: all 0.15s ease-out;

      /* DEFAULT FALLBACK (White Card) */
      background-color: var(--bg-surface);
      color: var(--text-main);
      border-left: 3px solid var(--text-muted);

      /* --- SEMANTIC VARIANTS --- */
      /* Logic: 
         1. Use the Bold Color (bg variable) for the left accent strip.
         2. Keep the background clean/white.
         3. Keep text dark for readability. 
      */
      
      /* REQUESTED (Yellow) */
      &.evt-requested {
        background-color: #fffbeb; /* Very light yellow tint (Hardcoded to match 'Yellow 50') */
        border-left: 3px solid var(--status-requested-bg); /* Bold Yellow Strip */
        
        /* Force text color to dark charcoal for contrast */
        .fc-event-main, .fc-event-time { color: #451a03; } 
      }

      /* SCHEDULED (Blue) */
      &.evt-scheduled {
        background-color: #eff6ff; /* Blue 50 */
        border-left: 3px solid var(--status-scheduled-bg); /* Bold Blue Strip */
        
        .fc-event-main, .fc-event-time { color: #172554; } /* Blue 950 text */
      }

      /* COMPLETED (Green) */
      &.evt-completed {
        background-color: #f0fdf4; /* Green 50 */
        border-left: 3px solid var(--status-completed-bg); /* Bold Green Strip */
        
        .fc-event-main, .fc-event-time { color: #052e16; } /* Green 950 text */
      }

      /* CANCELLED (Red) */
      &.evt-canceled, &.evt-cancelled {
        background-color: #fef2f2; /* Red 50 */
        border-left: 3px solid var(--status-cancelled-bg); /* Bold Red Strip */
        
        .fc-event-main, .fc-event-time { color: #450a0a; } /* Red 950 text */
      }

      /* RESCHEDULED (Purple) */
      &.evt-rescheduled {
        background-color: #faf5ff; /* Purple 50 */
        border-left: 3px solid var(--status-rescheduled-bg); /* Bold Purple Strip */
        
        .fc-event-main, .fc-event-time { color: #3b0764; } /* Purple 950 text */
      }
      
      /* Interaction: Lift and Brighten */
      &:hover {
        transform: translateY(-2px); 
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        filter: brightness(0.98); /* Slight contrast bump */
        z-index: 10;
      }
    }

    /* Event Content Text */
    .fc-event-main {
      font-size: 0.75rem;
      font-weight: 600; 
      line-height: 1.3;
      padding: 0.125rem 0;
    }

    /* Time Text inside Event */
    .fc-event-time {
      font-weight: 500;
      font-size: 0.7rem;
      opacity: 0.85;
      margin-bottom: 0.125rem;
    }

    /* E. Current Time Indicator */
    .fc-timegrid-now-indicator-line {
      border-color: var(--status-cancelled-bg); /* Use the Red Bold variable */
      border-width: 2px;
    }
    .fc-timegrid-now-indicator-arrow {
      border-color: var(--status-cancelled-bg); 
    }
  }
}

/* 4. The Side Panel (Drawer) */
.side-panel {
  flex-shrink: 0;
  width: 25rem; 
  max-width: 40vw; 
  
  background: var(--bg-surface);
  border: 0.0625rem solid var(--border-subtle);
  border-radius: var(--radius-md);
  
  display: flex; 
  flex-direction: column;
  overflow: hidden; 
  
  box-shadow: var(--shadow-lg);

  /* Force child components to fill the drawer height */
  app-appointment-view-panel,
  app-create-appointment {
    flex: 1;      
    height: 100%; 
    min-height: 0;
  }
}